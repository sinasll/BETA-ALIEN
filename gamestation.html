<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Game Station</title>
    <link rel="stylesheet" href="gamestationstyle.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap">
    <style>
        /* Basic styling for modals */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            background-color: rgba(0, 0, 0, 0.5); /* Black background with opacity */
            overflow: auto; /* Enable scroll if needed */
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto; /* 10% from the top and centered */
            padding: 20px;
            border-radius: 10px; /* Rounded corners */
            width: 80%; /* Responsive width */
            max-width: 600px; /* Max width for larger screens */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Shadow effect */
            text-align: center;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
        }

        /* Responsive styling for mobile devices */
        @media (max-width: 600px) {
            .modal-content {
                width: 90%; /* Increase width for small screens */
                margin: 20% auto; /* Adjust margin for better positioning */
            }
        }
    </style>
    <script>
        let tickets;
        let points;
        let lastDailyRewardDate;
        
        // Function to initialize ticket count and daily reward data from localStorage
        function initializeTickets() {
            let savedTickets = localStorage.getItem('tickets');
            tickets = savedTickets ? parseInt(savedTickets, 10) : 5;
            localStorage.setItem('tickets', tickets);

            let savedPoints = localStorage.getItem('points');
            points = savedPoints ? parseInt(savedPoints, 10) : 0;
            localStorage.setItem('points', points);

            lastDailyRewardDate = localStorage.getItem('lastDailyRewardDate');
            if (!lastDailyRewardDate) {
                lastDailyRewardDate = new Date().toISOString().split('T')[0];
                localStorage.setItem('lastDailyRewardDate', lastDailyRewardDate);
            }
        }

        // Function to open the game
        function openGame() {
            if (tickets > 0) {
                window.location.href = "ufo.html";
                tickets--;
                localStorage.setItem('tickets', tickets);
                updateTicketsDisplay();
            } else {
                alert("You do not have enough tickets to play.");
            }
        }

        // Function to update the ticket count and points display
        function updateTicketsDisplay() {
            document.getElementById('tickets-text').textContent = `You have ${tickets} tickets`;
            document.getElementById('score-text').textContent = ` ${points}`;
            document.getElementById('play-button').disabled = tickets <= 0;
        }

        // Function to generate a random username
        function generateRandomUsername() {
            return 'User' + Math.floor(Math.random() * 10000);
        }

        // Function to set username based on Telegram data or random username
        function setUsername() {
            let username = localStorage.getItem('username');
            
            if (username) {
                document.getElementById('username').textContent = username;
            } else {
                if (window.Telegram && window.Telegram.WebApp) {
                    const user = window.Telegram.WebApp.initDataUnsafe.user;
                    username = user && user.username ? user.username : generateRandomUsername();
                    localStorage.setItem('username', username);
                } else {
                    username = generateRandomUsername();
                    localStorage.setItem('username', username);
                }
                document.getElementById('username').textContent = username;
            }
        }

        // Function to update the ads watched count and ticket reward
        function updateAdsWatched() {
            let adsWatched = localStorage.getItem('adsWatched');
            adsWatched = adsWatched ? parseInt(adsWatched, 10) : 0;

            adsWatched++;
            localStorage.setItem('adsWatched', adsWatched);

            if (adsWatched % 5 === 0) {
                tickets++;
                localStorage.setItem('tickets', tickets);
                updateTicketsDisplay();
                alert('Congratulations! You have earned a bonus ticket!');
            } else {
                showAdViewModal();
            }
        }

        // Function to show the ad view modal
        function showAdViewModal() {
            document.getElementById('ad-view-modal').style.display = 'block';
        }

        // Function to close the ad view modal and update ticket count
        function closeAdView() {
            document.getElementById('ad-view-modal').style.display = 'none';

            let adsWatched = localStorage.getItem('adsWatched');
            adsWatched = adsWatched ? parseInt(adsWatched, 10) : 0;

            adsWatched++;
            localStorage.setItem('adsWatched', adsWatched);

            if (adsWatched % 5 === 0) {
                tickets++;
                localStorage.setItem('tickets', tickets);
                updateTicketsDisplay();
                alert('Congratulations! You have earned a bonus ticket!');
            } else {
                alert('You need to watch more ads to claim a bonus ticket.');
            }
        }

        // Function to show the daily reward modal
        function showDailyRewardModal() {
            document.getElementById('daily-reward-modal').style.display = 'block';
            updateDailyRewardUI();
        }

        // Function to update daily reward UI
        function updateDailyRewardUI() {
            const today = new Date().toISOString().split('T')[0];
            const dayNumber = Math.min(new Date(today) - new Date(lastDailyRewardDate), 7) / (24 * 60 * 60 * 1000);

            let rewardStatus = '';
            for (let i = 1; i <= 7; i++) {
                rewardStatus += `<button class="reward-button" ${i <= dayNumber ? 'disabled' : ''} onclick="claimDailyReward(${i})">Day ${i}</button>`;
            }
            document.getElementById('daily-reward-days').innerHTML = rewardStatus;
        }

        // Function to claim the daily reward
        function claimDailyReward(day) {
            const today = new Date().toISOString().split('T')[0];
            const dayNumber = Math.min(new Date(today) - new Date(lastDailyRewardDate), 7) / (24 * 60 * 60 * 1000);

            if (day > dayNumber) {
                alert('You cannot claim a reward for a future day.');
                return;
            }

            if (dayNumber === 7) {
                alert('You have already claimed all rewards for this week.');
                return;
            }

            showAdViewModalForReward();
        }

        // Function to show ad view modal for daily reward
        function showAdViewModalForReward() {
            document.getElementById('ad-view-modal').style.display = 'block';
            document.getElementById('ad-view-modal').onclick = function() {
                closeDailyReward();
            }
        }

        // Function to close daily reward modal and give reward
        function closeDailyReward() {
            points += 50;
            tickets += 5;
            localStorage.setItem('points', points);
            localStorage.setItem('tickets', tickets);
            lastDailyRewardDate = new Date().toISOString().split('T')[0];
            localStorage.setItem('lastDailyRewardDate', lastDailyRewardDate);
            document.getElementById('daily-reward-modal').style.display = 'none';
            updateTicketsDisplay();
            alert('Congratulations! You have received your daily reward!');
        }

        // Initialize the page
        window.onload = function() {
            initializeTickets();
            updateTicketsDisplay();
            setUsername();
        };
    </script>
</head>
<body>
    <!-- Header with score -->
    <header>
        <div class="profile">
            <img src="alien.png" alt="Profile Picture" class="profile-pic">
            <span id="username" class="username"></span>
        </div>
        <div class="score-container">
            <span id="score-text" class="score"></span>
            <img src="alincoin.png" alt="Alien Icon" class="alien-icon">
        </div>
    </header>

    <!-- Play Section -->
    <div class="play-container">
        <button id="play-button" class="play-box" onclick="openGame()">
            <h2>PLAY</h2>
        </button>
        <div id="tickets-text" class="tickets-text"></div>
        <button class="button" onclick="showAdViewModal()">Bonus ticket</button>
        <button class="button" onclick="showDailyRewardModal()">Daily reward</button>
    </div>
    <!-- Navigation Bar -->
    <nav>
        <ul class="nav-bar">
            <li class="nav-item active">
                <a href="gamestation.html">
                    <i class="fas fa-gamepad" aria-hidden="true"></i> <!-- Game Icon -->
                </a>
            </li>
            <li class="nav-item">
                <a href="tasks.html">
                    <i class="fas fa-tasks" aria-hidden="true"></i> <!-- Task Icon -->
                </a>
            </li>
            <li class="nav-item">
                <a href="friends.html">
                    <i class="fas fa-users" aria-hidden="true"></i> <!-- Friends Icon -->
                </a>
            </li>
        </ul>
    </nav>
</body>
</html>
